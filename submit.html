<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NAVgator · Submit Token</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@300;400;500&display=swap');
  :root {
    --bg: #0d0d0d; --bg2: #131313; --bg3: #1a1a1a;
    --white: #e8e6e3; --text: #c8c5c0; --muted: #8a8780; --dim: #555560;
    --green: #00e5a0; --red: #e84057; --orange: #ff8855;
    --border: rgba(255,255,255,0.06); --border2: rgba(255,255,255,0.1);
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; min-height: 100vh; }
  a { color: var(--green); text-decoration: none; }
  a:hover { opacity: 0.85; }

  .wrap { max-width: 560px; margin: 0 auto; padding: 40px 20px 60px; }

  .header { display: flex; align-items: center; gap: 14px; margin-bottom: 36px; }
  .back { font-size: 22px; color: var(--muted); text-decoration: none; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border: 1px solid var(--border2); border-radius: 8px; transition: all 0.15s; }
  .back:hover { color: var(--white); border-color: var(--green); }
  .page-title { font-size: 22px; font-weight: 700; color: var(--white); }
  .page-sub { font-size: 13px; color: var(--muted); margin-top: 2px; }

  .field { margin-bottom: 18px; }
  .field label { display: block; font-size: 12px; font-weight: 500; color: var(--muted); margin-bottom: 6px; }
  .field label .req { color: var(--green); }
  .field input {
    width: 100%; font-family: 'Inter', sans-serif; font-size: 14px; padding: 12px 14px;
    border-radius: 10px; border: 1px solid var(--border2); background: var(--bg2);
    color: var(--white); transition: border-color 0.15s; outline: none;
  }
  .field input:focus { border-color: var(--green); }
  .field input::placeholder { color: var(--dim); }
  .field .hint { font-size: 10px; color: var(--dim); margin-top: 4px; }

  .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

  .submit-btn {
    width: 100%; padding: 14px; font-family: 'Inter', sans-serif; font-size: 14px;
    font-weight: 600; border: none; border-radius: 10px; cursor: pointer;
    background: var(--green); color: #0c0c10; transition: all 0.2s; margin-top: 8px;
  }
  .submit-btn:hover { opacity: 0.9; transform: translateY(-1px); }
  .submit-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

  .status { margin-top: 16px; padding: 14px; border-radius: 10px; font-size: 13px; display: none; }
  .status.success { display: block; background: rgba(0,229,160,0.1); border: 1px solid rgba(0,229,160,0.2); color: var(--green); }
  .status.error { display: block; background: rgba(232,64,87,0.1); border: 1px solid rgba(232,64,87,0.2); color: var(--red); }

  .info-box { background: var(--bg2); border: 1px solid var(--border2); border-radius: 10px; padding: 16px; margin-bottom: 28px; font-size: 12px; color: var(--muted); line-height: 1.7; }
  .info-box b { color: var(--white); font-weight: 600; }

  .discovery { display: none; margin-top: 24px; }
  .discovery.show { display: block; }
  .disc-section { background: var(--bg2); border: 1px solid var(--border2); border-radius: 10px; padding: 16px; margin-bottom: 12px; }
  .disc-title { font-size: 11px; font-weight: 600; color: var(--dim); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; }
  .disc-row { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px solid var(--border); font-size: 12px; }
  .disc-row:last-child { border-bottom: none; }
  .disc-label { color: var(--muted); }
  .disc-value { color: var(--white); font-family: 'JetBrains Mono', monospace; font-size: 11px; }
  .disc-value.green { color: var(--green); }
  .disc-holder { padding: 6px 0; border-bottom: 1px solid var(--border); font-size: 11px; }
  .disc-holder:last-child { border-bottom: none; }
  .disc-addr { font-family: 'JetBrains Mono', monospace; color: var(--white); font-size: 10px; }
  .disc-badge { display: inline-block; font-size: 9px; font-weight: 600; padding: 2px 6px; border-radius: 4px; margin-left: 6px; }
  .disc-badge.dao { background: rgba(0,229,160,0.15); color: var(--green); }
  .disc-badge.amm { background: rgba(91,141,239,0.15); color: #5b8def; }
  .disc-badge.lock { background: rgba(255,140,66,0.15); color: var(--orange); }
  .disc-badge.meta { background: rgba(159,140,252,0.15); color: #9f8cfc; }

  .footer { text-align: center; font-size: 11px; color: var(--dim); padding-top: 30px; border-top: 1px solid var(--border); }
</style>
</head>
<body>
<div class="wrap">

  <div class="header">
    <a href="index.html" class="back">←</a>
    <div>
      <div class="page-title">Submit a Token</div>
      <div class="page-sub">Add a MetaDAO project to NAVgator</div>
    </div>
  </div>

  <div class="info-box">
    <b>Just paste the token address.</b> Our backend auto-discovers treasury wallets, AMM pools, supply, and price from on-chain data. Results are reviewed before going live.
  </div>

  <form id="submit-form" onsubmit="return handleSubmit(event)">
    <div class="field">
      <label>Token Mint Address <span class="req">*</span></label>
      <input type="text" name="mint" id="input-mint" placeholder="Paste Solana token mint address" required>
      <div class="hint">The SPL token contract address</div>
    </div>

    <div class="row">
      <div class="field">
        <label>Token Name <span class="req">*</span></label>
        <input type="text" name="name" id="input-name" placeholder="e.g. Solomon" required>
      </div>
      <div class="field">
        <label>Ticker <span class="req">*</span></label>
        <input type="text" name="ticker" id="input-ticker" placeholder="e.g. SOLO" required>
      </div>
    </div>

    <div class="field">
      <label>Twitter / X</label>
      <input type="text" name="twitter" placeholder="@projectname">
    </div>

    <button type="submit" class="submit-btn" id="submit-btn">Discover & Submit</button>
    <div class="status" id="status"></div>
  </form>

  <div class="discovery" id="discovery"></div>

  <div class="footer">
    <a href="index.html">← NAVgator Home</a> · Submissions reviewed before going live · Not financial advice
  </div>

</div>

<script>
var META_HOLDING = '6awyHMshBGVjJ3ozdSJdyyDE1CTAXUwrpNMaRGMsb4sf';

async function handleSubmit(e) {
  e.preventDefault();
  var btn = document.getElementById('submit-btn');
  var status = document.getElementById('status');
  var discovery = document.getElementById('discovery');
  btn.disabled = true;
  btn.textContent = 'Scanning on-chain data…';
  status.className = 'status';
  status.style.display = 'none';
  discovery.className = 'discovery';

  var form = document.getElementById('submit-form');
  var data = {};
  new FormData(form).forEach(function(v, k) { data[k] = v; });

  try {
    var res = await fetch('https://navgator-api.vercel.app/api/discover', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    var json = await res.json();

    if (res.ok && json.draft) {
      status.className = 'status success';
      status.textContent = '✓ Token discovered and submitted for review!';
      status.style.display = 'block';
      renderDiscovery(json.draft);
    } else {
      throw new Error(json.error || 'Discovery failed');
    }
  } catch (err) {
    status.className = 'status error';
    status.textContent = '✗ ' + err.message;
    status.style.display = 'block';
  }
  btn.disabled = false;
  btn.textContent = 'Discover & Submit';
}

function renderDiscovery(draft) {
  var el = document.getElementById('discovery');
  var fmtAddr = function(a) { return a ? a.slice(0, 6) + '…' + a.slice(-4) : '—'; };
  var fmtN = function(n) { return n >= 1e6 ? (n / 1e6).toFixed(2) + 'M' : n >= 1e3 ? (n / 1e3).toFixed(0) + 'K' : (n || 0).toString(); };
  var fmtP = function(n) { return n >= 1 ? '$' + n.toFixed(2) : n > 0 ? '$' + n.toFixed(6) : '—'; };

  var html = '';

  // Overview
  html += '<div class="disc-section"><div class="disc-title">Token Overview</div>';
  html += '<div class="disc-row"><span class="disc-label">Name</span><span class="disc-value">' + draft.ticker + ' — ' + draft.name + '</span></div>';
  html += '<div class="disc-row"><span class="disc-label">Price</span><span class="disc-value green">' + fmtP(draft.spot) + '</span></div>';
  html += '<div class="disc-row"><span class="disc-label">Supply</span><span class="disc-value">' + fmtN(draft.supply.total) + '</span></div>';
  html += '<div class="disc-row"><span class="disc-label">MetaDAO Holdings</span><span class="disc-value">' + fmtN(draft.metaHoldingTokens) + '</span></div>';
  html += '</div>';

  // Top holders
  if (draft.holders && draft.holders.length > 0) {
    html += '<div class="disc-section"><div class="disc-title">Top Holders (auto-classified)</div>';
    draft.holders.forEach(function(h) {
      var badge = '';
      if (h.address === draft.classified.likelyDAO) badge = '<span class="disc-badge dao">Likely DAO</span>';
      else if (h.address === draft.classified.likelyFutAmm) badge = '<span class="disc-badge amm">Likely Fut AMM</span>';
      else if (h.address === draft.classified.likelyTeamLock) badge = '<span class="disc-badge lock">Likely Team Lock</span>';
      else if (h.address === META_HOLDING) badge = '<span class="disc-badge meta">MetaDAO</span>';

      html += '<div class="disc-holder">';
      html += '<div><span class="disc-addr">' + fmtAddr(h.address) + '</span>' + badge + '</div>';
      html += '<div style="display:flex;gap:16px;margin-top:2px;color:var(--dim)">';
      html += '<span>' + fmtN(h.tokenBalance) + ' tokens (' + h.tokenPct + ')</span>';
      if (h.usdcBalance > 0) html += '<span style="color:var(--green)">' + fmtN(h.usdcBalance) + ' USDC</span>';
      html += '</div></div>';
    });
    html += '</div>';
  }

  // Meteora pools
  if (draft.meteoraPools && draft.meteoraPools.length > 0) {
    html += '<div class="disc-section"><div class="disc-title">Meteora Pools Found</div>';
    draft.meteoraPools.forEach(function(p) {
      html += '<div class="disc-row"><span class="disc-addr">' + fmtAddr(p.address) + '</span><span class="disc-value">' + (p.isUSDCPair ? 'USDC pair' : 'Other pair') + '</span></div>';
    });
    html += '</div>';
  }

  // Suggested config
  html += '<div class="disc-section"><div class="disc-title">Suggested Config (for tokens.js)</div>';
  html += '<pre style="font-size:10px;color:var(--text);overflow-x:auto;white-space:pre-wrap;font-family:JetBrains Mono,monospace;line-height:1.6">';
  var cfg = draft.suggestedConfig;
  var key = draft.ticker.toLowerCase();
  html += key + ': {\n';
  html += '  ticker: \'' + draft.ticker + '\', name: \'' + draft.name + '\',\n';
  html += '  mint: \'' + cfg.mint + '\',\n';
  html += '  usdcMint: \'' + cfg.usdcMint + '\',\n';
  html += '  daoWallet: \'' + cfg.daoWallet + '\',\n';
  html += '  futAmm: \'' + cfg.futAmm + '\',\n';
  html += '  metAmm: \'' + cfg.metAmm + '\',\n';
  html += '  metAmmUsdc: \'' + cfg.metAmmUsdc + '\',\n';
  if (cfg.teamLocked) html += '  teamLocked: \'' + cfg.teamLocked + '\',\n';
  if (cfg.buybackWallet) html += '  buybackWallet: \'' + cfg.buybackWallet + '\',\n';
  html += '  pubMetPool: \'' + cfg.pubMetPool + '\',\n';
  html += '  monthlyAllowance: ' + cfg.monthlyAllowance + ',\n';
  html += '},';
  html += '</pre></div>';

  el.innerHTML = html;
  el.className = 'discovery show';
}
</script>
</body>
</html>
